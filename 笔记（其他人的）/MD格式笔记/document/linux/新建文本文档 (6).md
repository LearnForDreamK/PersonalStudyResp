

## 首先

准备环境

linux 环境，docker

## 第二

使用 doker pull tomcat 拉取最新版本的tomcat

启动tomcat docker run -it --name tomcat tomcat (测试)

启动成功后 把容器里的conf 文件拷贝到linux文件夹中 （重要）docker cp tomcat:usr/local/tomcat/conf  /root/myconf

## 第三

把 tomcat 容器清除 docker rm -f tomcat

再次启动 docker run -it -p 8080:8080 -v /root/myconf/conf:/local/tomcat/conf --name tomcat tomcat (把主机配置文件关联到容器中以便于修改)

## 第四

把项目 war 包 复制到主机 /root/wabapps 下

执行 docker cp /root/wabapps/hellowrld.war tomcat:usr/local/tomcat/wabapps (复制项目到容器内)

docker restart tomcat （重启容器）

## 成功访问即可







# [Linux防火墙开放某端口号](https://www.cnblogs.com/Azi-mi/p/10514952.html)

![img](https://img2018.cnblogs.com/blog/1520688/201903/1520688-20190312101757064-483433948.png)

 

centos7防火墙管理

 

安装防火墙

yum install firewalld systemd -y

 

查看已经开放的端口：

firewall-cmd --list-ports

开放端口

firewall-cmd --zone=public --add-port=80/tcp --permanent

重启防火墙:

systemctl reload firewalld

 

报错: FirewallD is not running

解决:

(忘记截图了, 借鉴一下: https://jingyan.baidu.com/album/5552ef47f509bd518ffbc933.html?picindex=2)

① systemctl status firewalld

查看firewalld状态，发现当前是dead状态，即防火墙未开启。

![img](https://img2018.cnblogs.com/blog/1520688/201908/1520688-20190830154110053-2095065635.png)

 

② systemctl start firewalld

开启防火墙，没有任何提示即开启成功。

再次通过systemctl status firewalld查看firewalld状态，显示running即已开启了。

![img](https://img2018.cnblogs.com/blog/1520688/201908/1520688-20190830154303043-458684475.png)

 

③ systemctl stop firewalld

如果要关闭防火墙设置，可能通过systemctl stop firewalld这条指令来关闭该功能。





https://www.cnblogs.com/ljhblogs/p/11887548.html部署项目







Docker没有vi命令的解决方案

guofangsky 2019-07-01 18:07:29   7988   收藏 9
分类专栏： 架构师  Spring Boot  Spring Cloud  RocketMQ  Kubernetes  Docker  Spring  程序员  搜索技术
版权
[root@VM_0_12_centos ~]# docker search redmine

[root@VM_0_12_centos ~]# docker pull redmine

[root@VM_0_12_centos ~]# docker exec -it xxxxxxx bash

 

发现docker镜像中的 redmine并没有安装 vi/vim/nano 等编辑命令。

解决步骤如下：

apt-get install vim
Reading package lists... Done
Building dependency tree       
Reading state information... Done
E: Unable to locate package vi
apt-get update


apt-get install vim


四步，完成。





# mysql8 docker 解决远程登录失败

1.登录MySQL

```
mysql -u root -p
```

输入您的密码

2.选择 mysql 数据库

因为 mysql 数据库中存储了用户信息的 user 表。

```
use mysql;
```

3.在 mysql 数据库的 user 表中查看当前 root 用户的相关信息

```
1.select host, user, authentication_string, plugin from user; 
2.show variables like '%skip_networking%';
```

执行完上面的命令后会显示一个表格

查看表格中 root 用户的 host，默认应该显示的 localhost，只支持本地访问，不允许远程访问。

4.授权 root 用户的所有权限并设置远程访问

```

CREATE USER 'root'@'%' IDENTIFIED BY '111111';
 
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '111111';
```

设置为远程登录

```
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%'  WITH GRANT OPTION;
```

GRANT ALL ON 表示所有权限，% 表示通配所有 host，可以访问远程。

5.刷新权限

所有操作后，应执行

```
flush privileges;
```





# MYSQL8修改密码

1.先查看服务器docker容器的使用情况，查看mysql是否运行

```
docker ps
```

![img](https://img2020.cnblogs.com/blog/1030057/202005/1030057-20200505152828287-1709600349.png)

 

 

 可以看到每个容器的id

2.进入mysql容器内部

```
docker exec -it 这里是mysql的容器id bash
```

3.然后输入mysql

![img](https://img2020.cnblogs.com/blog/1030057/202005/1030057-20200505153139215-323408214.png)

 

4.输入命令修改密码

```
alter user 'root'@'localhost' identified with mysql_native_password by '新密码';
```

5.

```
flush privileges;
```





# docker部署war项目



使用Docker部署war包项目

请叫我小叶子 2019-05-31 15:59:11   8424   收藏 26
分类专栏： Java高级
版权
        使用Docker部署war，必须要用容器，我们就用tomcact容器，其实都是将war包丢到tomcat的webapps目录下，tomcat启动的情况下会自动解压war包。

       一种是在Docker中安装tomcat容器的镜像，然后把war包丢到tomcat镜像下webapps中即可。但是如果tomcat关闭了，其webapps下的包就会消失；二就是利用挂载，还是安装tomcat容器的镜像，但是不把war包丢到tomcat下的webapps中，直接创建一个外部文件夹，将这个外部文件夹跟wabapps关联，这样把war丢到新建的文件夹中，tomcat的webapps也能读取到这个war包，这就是挂载。

一、安装tomcat镜像并启动

1、docker下搜索tomcat镜像，前提是docker处于启动状态，docker如何启动以及如何设置开机自启，这里就不说了

docker search tomcat



2、根据名字下载docker，docker pull docker.io/tomcat



3、启动tomcat

 docker run -d -p 8088:8080 docker.io/tomcat

 -d表示后台运行，-p端口映射，前面的8088是外围访问端口（也就是本机ip对外开放的端口），后面8080是docker容器内部的端口。

4、浏览器访问，看tomcat是否启动



三、将springboot项目改造成war包项目

       使用springboot习惯了，再创建一个war包项目，比较麻烦，我就新建了一个springboot项目，然后改成war项目，如果你本身是war包项目，可以忽略这一步了。

1、创建一个springboot项目，这个就不讲了，需要的可以自己看我的另一篇博客：原 SpringBoot之创建并简单使用SpringBoot

2、修改pom.xml文件

   2.1将jar改成war



  2.2移除内置web模块自带的tomcat



  2.3 添加servlet依赖，不然打包报错

<dependency>
    <groupId>javax.servlet</groupId>
	<artifactId>javax.servlet-api</artifactId>
	<version>3.1.0</version>
</dependency>
   2.4 给项目加别名，在build标签下增加finalName，就是项目名了，如果不加，项目名就是你的artifactId-version，生成的war包名称也是artifactId-version.war，浏览器访问的时候项目名字太长了。这一步看个人爱好



3、 修改启动类，启动类继承SpringBootServletInitializer



四、将war包放在tomcat容器的webapps下启动war包

1、随便创建一个文件夹，用来存放上传的war包，我放在了根目录/下了

mkdir warPackage，然后将文件传到该目录下



2、将war包拷贝进tomcat容器的webapps目录下

2.1、需要知道运行的tomcat容器的容器ID，运行docker ps



2.2、拷贝war包进tomcat容器的webapps目录下，命令格式：docker cp xxx.war包路径 容器ID:/要复制过去的目录路径

 

    docker cp /warPackage/dockerProject.war e591e16899c6:/usr/local/tomcat/webapps

2.3、查看是否拷贝进去了

进入docker中的tomcat容器中：docker exec -it e591e16899c6 /bin/bash

退出容器：exit



3、重启容器：docker restart +容器ID



4、浏览器访问路径为：你刚才访问的端口:项目名/接口名，我的项目名是dockerProject，docker是我写的一个简单的Controller



五、使用挂载目录启动war包

挂载就是在服务器单独创建一个目录，然后映射到tomcat下的webapps的路径，这样tomcat就能读取外部文件夹中的文件了

1、为了省事，我就直接使用上面创建的/warPackage文件夹

2、进行挂载目录，运行tomcat容器，设置开机自启：--restart=always

docker run -d -p 8088:8080 -v /warPackage/:/usr/local/tomcat/webapps --restart=always docker.io/tomcat

再通过进入tomcat目录，能看到已经在webapps下了



3、浏览器访问





```shell
$ docker run -d --name halo -p 8090:8090 -v ~/halo:/root/halo -e DB_USER=root -e DB_PASSWORD=123456 ruibaby/halo
```

# Docker部署Hola